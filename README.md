# Photorithm - AI-Powered Image Transformation Platform

A Next.js application that leverages AI to transform images with features like background removal, object removal, color adjustments, and more. Built with modern web technologies and integrated with Cloudinary for image processing.

## Features

- **Multiple Transformation Types**
  - Image Restoration
  - Background Removal
  - Object Removal
  - Object Recoloring
  - Generative Fill
  - Background Replacement
- **Credits-Based System**
  - Users spend credits to perform image transformations.
  - Credits can be purchased securely via Stripe and are tracked in user profiles.
- **User Management**
  - Authentication with Clerk
  - User profiles
  - Credit system for transformations
  - Transaction history
- **Image Management**
  - Secure image uploads
  - Real-time transformation preview
  - Download transformed images
  - Private/public image settings
  - Image collection management

## Tech Stack

- **Frontend**
  - Next.js 15 (App Router)
  - TypeScript
  - Tailwind CSS
  - shadcn/ui Components

- **Backend**
  - Next.js 15 Server Actions
  - Next.js API Routes
  - MongoDB with Mongoose
  - Cloudinary for image processing
  - Clerk for authentication
  - Stripe for payments

## Prerequisites

Before running the application, ensure you have:

1. **Cloudinary Account**
   - Create an account at [Cloudinary](https://cloudinary.com)
   - Set up an upload preset with the following settings:
     - Signing Mode: Unsigned
     - Folder: Your preferred folder name
     - Auto Tagging: Enabled (for better image analysis)
     - Moderation: Optional (based on your needs)

2. **MongoDB Database**
   - Create a MongoDB database
   - Get your connection string

3. **Clerk Account**
   - Create an account at [Clerk](https://clerk.com)
   - Set up your application
   - Configure webhook endpoints for the following events:
     - `user.created` - For creating new user records
     - `user.updated` - For updating user profiles
     - `user.deleted` - For cleaning up user data

4. **Stripe Account**
   - Create an account at [Stripe](https://stripe.com)
   - Get your API keys
   - Set up webhook endpoints for the following event:
     - `checkout.session.completed` - For processing successful payments and updating user credits

## Important Note

This application uses webhooks for various functionalities. To run it locally, you'll need to expose your local endpoints to the internet. It's recommended to:

1. Deploy the application to a platform of your choice first
2. Use the deployed webhook URLs for your service configurations:
   - Clerk webhook URL: `https://your-domain.com/api/webhooks/clerk`
   - Stripe webhook URL: `https://your-domain.com/api/webhooks/stripe`
3. Then run the application locally for development

## Environment Variables

Create a `.env` file in the root directory with the following variables:

```env
# MongoDB
MONGODB_URL=your_mongodb_connection_string
MONGODB_DATABASE_NAME=your_database_name

# Cloudinary
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloud_name
NEXT_PUBLIC_CLOUDINARY_IMAGE_PRESET=your_upload_preset
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
CLOUDINARY_IMAGE_FOLDER=your_folder_name

# Clerk
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_publishable_key
CLERK_SECRET_KEY=your_secret_key
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/

# Stripe
STRIPE_SECRET_KEY=your_stripe_secret_key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret

# Internal API Security
INTERNAL_API_SECRET=your_internal_secret

# Server URL (for internal fetches)
NEXT_PUBLIC_SERVER_URL=https://your-domain.com

# (Optional) Clerk/Stripe Webhook Secret
WEBHOOK_SECRET=your_clerk_webhook_secret
```

## Getting Started

1. Clone the repository
2. Install dependencies:
   ```bash
   npm install
   ```
3. Set up your environment variables
4. Run the development server:
   ```bash
   npm run dev
   ```

## Project Structure

```
photorithm/
├── actions/     # Server actions for data mutation (e.g., create, update, delete operations on models)
├── app/         # Next.js app router pages, layouts, and API routes
├── components/  # React components (UI and shared). 'components/ui' is auto-generated by shadcn/ui; see components.json for config.
├── constants/   # Application constants
├── data/        # Data fetching from the database (read/query logic)
├── database/    # Database models and connection (Mongoose)
├── lib/         # Utility/helper functions
├── public/      # Static assets (images, icons, etc.)
├── types/       # TypeScript type definitions
```

- **actions/**: Server actions for data mutation (create, update, delete operations on models).
- **data/**: Data fetching from the database (read/query logic, no mutation).
- **components/**: All React components. The `components/ui` folder is auto-generated by shadcn/ui (see `components.json`).
- **app/**: Next.js app directory for routing, layouts, pages, and API endpoints.
- **constants/**: Centralized constants for use throughout the app.
- **database/**: Mongoose models and connection logic for MongoDB.
- **lib/**: Utility/helper functions.
- **public/**: Static files served directly by Next.js.
- **types/**: TypeScript type definitions for strong typing across the codebase.

## Special/Internal API Routes

- **Startup Routes (`/api/startup/image`, `/api/startup/user/[id]`)**: Internal-only, used for fast, cacheable data fetching on initial page loads. Require `x-internal-secret` header. See file-level docs in each route for details.

> **Note:** These routes are intended to be removed in the future. Once the Next.js `useCache` feature is stable, caching will be handled directly in the data fetching functions.

- **Webhooks (`/api/webhooks/clerk`, `/api/webhooks/stripe`)**: Used for user and payment event handling. Must be configured in Clerk and Stripe dashboards.
- **Cloudinary Cleanup (`/api/cloudinary/cleanup`)**: Removes orphaned images from Cloudinary. Recommended to run on a schedule (e.g., CRON job).


